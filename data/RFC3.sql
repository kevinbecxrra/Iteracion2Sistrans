SELECT CONT.ID AS ID_OFERTA, CONT.CAPACIDAD, TOTAL.ALOJADAS, TOTAL.ALOJADAS/CONT.CAPACIDAD AS INDICE
FROM CONTRATO CONT JOIN (SELECT ID_CONTRATO, SUM(PERSONAS) AS ALOJADAS
                    FROM RESERVA
                    GROUP BY ID_CONTRATO) TOTAL
              ON CONT.ID=TOTAL.ID_CONTRATO
ORDER BY INDICE DESC;
